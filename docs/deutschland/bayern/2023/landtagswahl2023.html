<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titel</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
        #legend svg {
            height: 300px;
        }
    </style>
</head>
<body>

<h1>Bayern - Landtagswahl 2023</h1>
<h2>Alternative Berechnungen (Seite noch im Aufbau)</h2>
<p>
    Datenquelle: <a href="https://www.landtagswahl2023.bayern.de/ergebnis_tabelle_990.html#anker">https://www.landtagswahl2023.bayern.de/ergebnis_tabelle_990.html#anker</a>
</p>

<svg id="diagram" width="600" height="500"></svg>
<div id="tooltip" ></div>
<svg id="legend"></svg>

<script>

    var Tooltip = d3.select("#tooltip")
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "2px")
        .style("border-radius", "5px")
        .style("padding", "5px")

    var mouseover = function(d) {
        Tooltip
            .style("opacity", 1)
        d3.select(this)
            .style("stroke", "black")
            .style("opacity", 1)
    }

    var mouseleave = function(d) {
        Tooltip
            .style("opacity", 0)
        d3.select(this)
            .style("stroke", "none")
            .style("opacity", 0.8)
    }

    var mousemoveAlt = function(d) {
        Tooltip
            .html("Anteil bezogen auf alle potentiellen Wählerstimmen<br>ist: " + (d.stimmen*100/gesamtstimmen).toFixed(2) + " %.")
            .style("left", (d3.mouse(this)[0]+70) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
    }

    var mousemoveOrg = function(d) {
        Tooltip
            .html("Anteil bezogen nur auf alle gültigen Wählerstimmen<br>ist: " + d.prozent + " %.")
            .style("left", (d3.mouse(this)[0]+70) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
    }

    <!-- diagram logic -->

    var svg = d3.select("#diagram"),
        margin = 200,
        width = svg.attr("width") - margin,
        height = svg.attr("height") - margin;


    var xScale = d3.scaleBand().range ([0, width]).padding(0.2),
        yScale = d3.scaleLinear().range ([height, 0]);

    var g = svg.append("g")
        .attr("transform", "translate(" + 100 + "," + 100 + ")");


    <!-- Beginn konkrete Daten -->
    var dataFileName = '2023_bayern_landtagswahl.csv';
    var gesamtstimmen = 18822796.0;
    var minProzentAnzeige = 0;
    var maxProzentAnzeige = 40;
    var tickAnzahl = (maxProzentAnzeige-minProzentAnzeige)/5;

    d3.csv(dataFileName, function(error, data) {
        if (error) {
            throw error;
        }

        var xdomain = data.map(function(d) { return d.name; });

        xScale.domain(xdomain);
        yScale.domain([minProzentAnzeige,maxProzentAnzeige]);

        g.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale).tickFormat(function(d){
                return ''+ d;
            }))
            .append("text")
            .attr("x", 600/2)
            .attr("dx", "-5.1em")
            .attr("y", 6)
            .attr("dy", "5.1em")
            .attr("text-anchor", "end")
            .attr("stroke", "black")
            .text("Parteien zur Wahl");

        g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d){
                return  d + ' %';
            }).ticks(tickAnzahl))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "-5.1em")
            .attr("text-anchor", "end")
            .attr("stroke", "black")
            .text("Stimmen in Prozent");

        <!-- Alternative Werte -->
        g.selectAll(".bar")
            .data(data)
            .enter().append("rect")
            .attr("class", "bar")
            .style('fill', d => d.altcolor)
            .attr("x", function(d) { return xScale(d.name); })
            .attr("y", function(d) { return yScale(d.stimmen*100/gesamtstimmen); })
            .attr("width", xScale.bandwidth()/2)
            .attr("height", function(d) { return height - yScale(d.stimmen*100/gesamtstimmen); })
            .on("mouseover", mouseover)
            .on("mousemove", mousemoveAlt)
            .on("mouseleave", mouseleave)
        ;


        <!-- Offizielle Werte -->
        g.selectAll(".barorg")
            .data(data)
            .enter().append("rect")
            .attr("class", "barorg")
            .style('fill', d => d.orgcolor)
            .attr("x", function(d) { return xScale(d.name)+25; })
            .attr("y", function(d) { return yScale(d.prozent); })
            .attr("width", xScale.bandwidth()/2)
            .attr("height", function(d) { return height - yScale(d.prozent); })
            .on("mouseover", mouseover)
            .on("mousemove", mousemoveOrg)
            .on("mouseleave", mouseleave)
        ;

        <!-- add legend -->
        var xOffset = 10;
        var yOffset = 100;
        var legendItemSize = 12;
        var legendSpacing = 4;

        var legend = d3.select("#legend");

        legend
            .enter()
            .append('rect')
            .attr('class', 'legendItem')
            .attr('width', legendItemSize)
            .attr('height', legendItemSize)
            .style('fill', d => d.color)
            .attr('transform',
                (d, i) => {
                    var x = xOffset;
                    var y = yOffset + (legendItemSize + legendSpacing) * i;
                    return `translate(${x}, ${y})`;
                });

        legend
            .enter()
            .append('text')
            .attr('x', xOffset + legendItemSize + 5)
            .attr('y', (d, i) => yOffset + (legendItemSize + legendSpacing) * i + 12)
            .text(d => d.name);

    });


</script>

<p>
    URL dieser Seite: <a href="Online unter: https://huluvu424242.github.io/alternative-wahlergebnisse/deutschland/bayern/2023/landtagswahl2023.html">
    Online unter: https://huluvu424242.github.io/alternative-wahlergebnisse/deutschland/bayern/2023/landtagswahl2023.html</a>
</p>

</body>
</html>